// TODO(agents): decide mode based on token estimate
